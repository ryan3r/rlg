#!/bin/bash

# Get the assignment number
if [ -z "$1" ]; then
	read -p "Assignment number: " assignment
else
	assignment=$1
fi

package_name="Ray_Ryan.assignment-$assignment"
workspace="/media/sf_cs327"

cd $workspace

# Remove any binaries
make clean -s

# Make the change log
if [ -d ".git" ]; then
	git log > CHANGELOG
fi

# Create the submissions directory
mkdir -p $workspace/submissions

# Create a copy with the correct name
cd ..
cp -r  $workspace /tmp/$package_name

# Remove any empty folders
cd /tmp/$package_name
find . -type d -empty -delete
cd ..

# Make the tar ball
tar cfz $package_name.tar.gz $package_name \
	--exclude=".*" --exclude="submissions" --exclude="deploy"

# Move the tar ball to the workspace
cp /tmp/$package_name.tar.gz  $workspace/submissions/$package_name.tar.gz

# Clean up
rm -rf $package_name
rm -f $package_name.tar.gz

# Tell the user that we are done
echo "Build complete"
